<div class="container mx-auto px-4">
    <div class="container-quadrado">
        <nav class="bg-blue-800 shadow-lg rounded-t-3xl">
            <div class="relative flex items-center h-16 px-4">
            <!-- Logo 
            <div class="flex items-center">
                <img src="{{ url_for('static', filename='img/opera.png') }}" alt="Opera Logo" class="navbar-logo">
            </div> -->
            
            <!-- Menu desktop centralizado -->
            <div class="hidden md:flex navbar-menu-center">
                {% if current_user and current_user.setor in ['Administrativo', 'T.I'] %}
                <a href="{{ url_for('index') }}" class="navbar-link text-white hover:text-gray-300 px-2 py-2 rounded-md text-sm font-medium transition duration-200 {{ 'active' if request.endpoint == 'index' }}">
                    PCP
                </a>
                <a href="{{ url_for('baixas') }}" class="navbar-link text-white hover:text-gray-300 px-2 py-2 rounded-md text-sm font-medium transition duration-200 {{ 'active' if request.endpoint == 'baixas' }}">
                    Baixas
                </a>
                {% endif %}
                {% if current_user and current_user.setor != 'Produção' %}
                <a href="http://10.150.16.45:5058/" target="_blank" class="navbar-link text-white hover:text-gray-300 px-2 py-2 rounded-md text-sm font-medium transition duration-200">
                    Etiquetas
                </a>
                {% endif %}
                {% if current_user and current_user.setor in ['Produção', 'Administrativo', 'T.I'] %}
                <a href="{{ url_for('otimizadas') }}" class="navbar-link text-white hover:text-gray-300 px-2 py-2 rounded-md text-sm font-medium transition duration-200 {{ 'active' if request.endpoint == 'otimizadas' }}">
                    Corte
                </a>
                <a href="{{ url_for('estoque') }}" class="navbar-link text-white hover:text-gray-300 px-2 py-2 rounded-md text-sm font-medium transition duration-200 {{ 'active' if request.endpoint == 'estoque' }}">
                    Estoque
                </a>
                <a href="{{ url_for('saidas') }}" class="navbar-link text-white hover:text-gray-300 px-2 py-2 rounded-md text-sm font-medium transition duration-200 {{ 'active' if request.endpoint == 'saidas' }}">
                    Saídas
                </a>
                <a href="{{ url_for('locais') }}" class="navbar-link text-white hover:text-gray-300 px-2 py-2 rounded-md text-sm font-medium transition duration-200 {{ 'active' if request.endpoint == 'locais' }}">
                    Locais
                </a>
                <a href="{{ corte_sso_link if sso_corte_enabled else acomp_corte_base_url or '#' }}" target="_blank" rel="noopener noreferrer" class="navbar-link text-white hover:text-gray-300 px-2 py-2 rounded-md text-sm font-medium transition duration-200">
                    Acomp. Corte
                </a>
                <a href="http://10.150.16.45:5002/" target="_blank" class="navbar-link text-white hover:text-gray-300 px-2 py-2 rounded-md text-sm font-medium transition duration-200">
                    Painel
                </a>
                {% endif %}
                {% if current_user and current_user.setor in ['Administrativo', 'T.I'] %}
                <a href="{{ url_for('arquivos') }}" class="navbar-link text-white hover:text-gray-300 px-2 py-2 rounded-md text-sm font-medium transition duration-200 {{ 'active' if request.endpoint == 'arquivos' }}">
                    Arquivos
                </a>
                {% endif %}

                {% if current_user and current_user.setor == 'T.I' %}
                <a href="{{ url_for('register') }}" class="navbar-link text-white hover:text-gray-300 px-2 py-2 rounded-md text-sm font-medium transition duration-200 {{ 'active' if request.endpoint == 'register' }}">
                    Usuários
                </a>
                {% endif %}
                {% if current_user and current_user.is_authenticated %}
                <a href="{{ url_for('logout') }}" class="navbar-link text-red-400 hover:text-red-300 px-2 py-2 rounded-md text-sm font-medium transition duration-200" title="Sair">
                    <i class="fas fa-sign-out-alt"></i>
                </a>
                {% endif %}
            </div>
            </div>
        </nav>
    </div>
</div>

<!-- Adicionar setor do usuário ao body para proteção de URL -->
<script>
{% if current_user and current_user.is_authenticated %}
document.body.dataset.userSector = '{{ current_user.setor }}';
{% endif %}

document.addEventListener('DOMContentLoaded', function() {
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    const menuIcon = document.getElementById('menu-icon');
    let isMenuOpen = false;
    
    if (mobileMenuButton && mobileMenu) {
        mobileMenuButton.addEventListener('click', function() {
            isMenuOpen = !isMenuOpen;
            
            if (isMenuOpen) {
                mobileMenu.classList.remove('-translate-y-full', 'opacity-0');
                mobileMenu.classList.add('translate-y-0', 'opacity-100');
                menuIcon.classList.remove('fa-bars');
                menuIcon.classList.add('fa-times');
            } else {
                mobileMenu.classList.remove('translate-y-0', 'opacity-100');
                mobileMenu.classList.add('-translate-y-full', 'opacity-0');
                menuIcon.classList.remove('fa-times');
                menuIcon.classList.add('fa-bars');
            }
        });
        
        // Fechar menu ao clicar em um link
        const menuLinks = mobileMenu.querySelectorAll('a');
        menuLinks.forEach(link => {
            link.addEventListener('click', () => {
                isMenuOpen = false;
                mobileMenu.classList.remove('translate-y-0', 'opacity-100');
                mobileMenu.classList.add('-translate-y-full', 'opacity-0');
                menuIcon.classList.remove('fa-times');
                menuIcon.classList.add('fa-bars');
            });
        });
    }
});
</script>

<!-- Sistema de logout automático -->
<script>
    window.OPERA_ACTIVITY_ALLOWED_ORIGINS = window.OPERA_ACTIVITY_ALLOWED_ORIGINS || [];
    {% if acomp_corte_base_url %}
    (function() {
        try {
            var rawUrl = {{ acomp_corte_base_url|tojson }};
            if (rawUrl) {
                var origin = new URL(rawUrl, window.location.href).origin;
                if (!window.OPERA_ACTIVITY_ALLOWED_ORIGINS.includes(origin)) {
                    window.OPERA_ACTIVITY_ALLOWED_ORIGINS.push(origin);
                }
            }
        } catch (error) {
            // ignora erros ao calcular origem
        }
    }());
    {% endif %}
</script>

<!-- Proteção contra manipulação de URL -->
<script src="{{ url_for('static', filename='js/url-protection.js') }}"></script>
